const url = "http://ip-api.com/json/?fields=8450015&lang=VN";

$httpClient.get(url, function(error, response, data) {
    if (error) {
        console.error('CÃ³ lá»—i xáº£y ra:', error);
        return;
    }

    try {
        const jsonData = JSON.parse(data);
        const { query, isp, as, country, city, timezone, lon, lat, currency, countryCode } = jsonData;
        const emoji = getFlagEmoji(countryCode);
        const body = {
            title: "ThÃ´ng tin",
            content: `IPï¼š${query}\nNhÃ  cung cáº¥pï¼š${isp}\nASNï¼š${as}\nðŸŒQuá»‘c gia/Khu vá»±cï¼š${emoji}${country}\nThÃ nh phá»‘ï¼š${city}\nMÃºi giá»ï¼š${timezone}\nVÄ© Ä‘á»™ vÃ  Kinh Ä‘á»™ï¼š${lon},${lat}\nTiá»n tá»‡ï¼š${currency}`,
            icon: "ðŸŒ",
            "icon-color": "blue"
        };
        $done(body);
    } catch (e) {
        console.error('Lá»—i khi phÃ¢n tÃ­ch dá»¯ liá»‡u JSON:', e);
    }
});

function getFlagEmoji(countryCode) {
    const codePoints = countryCode
        .toUpperCase()
        .split('')
        .map(char => 127397 + char.charCodeAt());
    return String.fromCodePoint(...codePoints);
}
